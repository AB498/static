<!DOCTYPE html>
<html lang="en" data-theme="light">

<head>
    <!-- <link rel="icon" href="https://cdn.simpleicons.org/json/red" /> -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>

    <script src="utils.js"></script>

    <!-- <script src="https://cdn.jsdelivr.net/npm/eruda-monitor@1.0.2/eruda-monitor.min.js"></script> -->
    <script src="current/assets/js/eruda.js"></script>
    <script>eruda.init({ tool: ['console', 'resources'] }); /*eruda.add(erudaMonitor);*/</script>

    <!-- <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://unpkg.com/simplebar@latest/dist/simplebar.css" />
    <script src="https://unpkg.com/simplebar@latest/dist/simplebar.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>
    <link href="https://unpkg.com/tabulator-tables@6.2.0/dist/css/tabulator.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/flat-ui/2.3.0/js/vendor/jquery.min.js"></script>
    <script type="text/javascript" src="https://unpkg.com/tabulator-tables@6.2.0/dist/js/tabulator.min.js"></script>
    <script src="http://chancejs.com/chance.min.js"></script>-->

    <link rel="stylesheet" href="current/assets/css/uicons-regular-rounded.css" />

    <script src="current/assets/js/gsap.js"></script>


    <script src="current/assets/js/alertify.min.js"></script>
    <link rel="stylesheet" href="current/assets/css/alertify.min.css" />

    <!-- react -->
    <script src="current/assets/js/react.development.js"></script>
    <script src="current/assets/js/react-dom.development.js"></script>
    <script src="current/assets/js/react-router-dom.min.js"></script>

    <!-- material ui -->
    <script src="current/assets/js/material-ui.production.min.js"></script>

    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.11.13/dayjs.min.js" ></script> -->

    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/antd/5.20.5/antd.min.js"></script> -->

    <script src="current/assets/js/utils.js"></script>

    <script type="module">
        import { JSONEditor } from "./current/assets/js/jsoneditor.js";
        window.JSONEditor = JSONEditor;
    </script>
    <!-- <link href="current/assets/css/daisy.min.css" rel="stylesheet" type="text/css" /> -->


    <!-- tailwindcss -->
    <script src="current/assets/js/tailwind.js"></script>
    <script>
        tailwind.config = {
            darkMode: "class",
        };
    </script>


    <style>
        .center {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .full {
            width: 100%;
            height: 100%;
        }

        .slink {
            cursor: pointer;
            color: lightblue;
        }

        .slink:hover {
            text-decoration: underline;
        }
    </style>

    <!-- pocketbase -->
    <script src="current/assets/js/pocketbase.umd.min.js"></script>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">
        let { React, ReactRouterDOM, MaterialUI, JSONEditor, PocketBase, gsap } = window;
        const { useState, useMemo, useEffect, createContext, useContext, useRef, isValidElement } = window.React;
        const { HashRouter, Route, Switch, Redirect, useHistory, useLocation, useParams } = ReactRouterDOM;
        let { Select, Modal, MenuItem, OutlinedInput, InputLabel, FormControl, Box, Chip } = MaterialUI;

        let transform = window.sucrase ? (code) => window.sucrase.transform(code, { transforms: ['jsx'] }).code : (code) => window.Babel.transform(code, { presets: ['react'] }).code;

        let APP_PREFIX = '';
        let APP_ASSETS_PREFIX = 'assets';

        let BTN_CLASS = "py-3 px-4 inline-flex items-center gap-x-2 text-sm font-medium rounded-lg border border-gray-200 bg-white text-gray-800 shadow-sm hover:bg-gray-50 focus:outline-none focus:bg-gray-50 disabled:opacity-50 disabled:pointer-events-none dark:bg-neutral-800 dark:border-neutral-700 dark:text-white dark:hover:bg-neutral-700 dark:focus:bg-neutral-700 cursor-pointer active:bg-gray-100 dark:active:bg-neutral-600 select-none";
        let BTN_PLAIN_CLASS = "flex items-center p-2 text-base font-normal text-gray-900 rounded-lg dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer gap-2 select-none";
        let CARD_CLASS = "flex flex-col bg-white border shadow-sm rounded-xl dark:bg-neutral-900 dark:border-neutral-700 dark:shadow-neutral-700/70";
        let CARD_TITLE_CLASS = "text-lg font-bold text-gray-800 dark:text-white";
        let CARD_BODY_CLASS = "p-4 md:p-5";
        let TH_CLASS = "px-6 py-3 text-start text-xs font-medium text-gray-500 uppercase dark:text-neutral-500";
        let TD_CLASS = "px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-800 dark:text-neutral-200";
        let TAB_BTN_CLASS = "text-gray-600 py-4 px-6 block hover:text-blue-500 focus:outline-none cursor-pointer select-none";
        let TAB_BTN_ACTIVE_CLASS = "text-blue-500 border-b-2 font-medium border-blue-500 cursor-pointer select-none";

        // export default { ... }
        let expts = {
            randInt, safe, uuid, addTime, setTime, useAsync, useForceUpdate, poll, useStream,
            subscribeFnSync, makeReactive, reactiveRef, useBreakpoint, isJSONObject,
            MakeComponent, DynamicSkeleton, CustomModal, CustomPopup, AsyncComponent, StreamComponent,
            BTN_CLASS, CARD_CLASS, CARD_TITLE_CLASS, CARD_BODY_CLASS, TH_CLASS, TD_CLASS,
        };

        [expts].forEach((mod) => {
            Object.keys(mod).forEach((key) => {
                window[key] = expts[key];
            });
        });


        async function getCollection(name) {
            return (await pb.collections.getFullList()).find(c => c.name == name) || null;
        }
        window.getCollection = getCollection;

        function log(...args) { console.log(...args); return args[args.length - 1]; }

        function MakeComponent({ resolver }) {
            return resolver();
        }

        function DynamicSkeleton(props) {
            let { children } = props || {};
            return (
                <div className={CARD_CLASS}>
                    <div className={CARD_BODY_CLASS}>
                        {children}

                        <div role="status" className="space-y-2.5 animate-pulse max-w-lg">
                            <div className="flex items-center w-full flex gap-2">
                                <div className="h-2.5 bg-gray-200 rounded-full dark:bg-gray-700 w-32"></div>
                                <div className="h-2.5 bg-gray-300 rounded-full dark:bg-gray-600 w-24"></div>
                                <div className="h-2.5 bg-gray-300 rounded-full dark:bg-gray-600 w-full"></div>
                            </div>
                            <div className="flex items-center w-full flex gap-2 max-w-[480px]">
                                <div className="h-2.5 bg-gray-200 rounded-full dark:bg-gray-700 w-full"></div>
                                <div className="h-2.5 bg-gray-300 rounded-full dark:bg-gray-600 w-full"></div>
                                <div className="h-2.5 bg-gray-300 rounded-full dark:bg-gray-600 w-24"></div>
                            </div>
                            <div className="flex items-center w-full flex gap-2 max-w-[400px]">
                                <div className="h-2.5 bg-gray-300 rounded-full dark:bg-gray-600 w-full"></div>
                                <div className="h-2.5 bg-gray-200 rounded-full dark:bg-gray-700 w-80"></div>
                                <div className="h-2.5 bg-gray-300 rounded-full dark:bg-gray-600 w-full"></div>
                            </div>
                            <div className="flex items-center w-full flex gap-2 max-w-[480px]">
                                <div className="h-2.5 bg-gray-200 rounded-full dark:bg-gray-700 w-full"></div>
                                <div className="h-2.5 bg-gray-300 rounded-full dark:bg-gray-600 w-full"></div>
                                <div className="h-2.5 bg-gray-300 rounded-full dark:bg-gray-600 w-24"></div>
                            </div>
                            <div className="flex items-center w-full flex gap-2 max-w-[440px]">
                                <div className="h-2.5 bg-gray-300 rounded-full dark:bg-gray-600 w-32"></div>
                                <div className="h-2.5 bg-gray-300 rounded-full dark:bg-gray-600 w-24"></div>
                                <div className="h-2.5 bg-gray-200 rounded-full dark:bg-gray-700 w-full"></div>
                            </div>
                            <div className="flex items-center w-full flex gap-2 max-w-[360px]">
                                <div className="h-2.5 bg-gray-300 rounded-full dark:bg-gray-600 w-full"></div>
                                <div className="h-2.5 bg-gray-200 rounded-full dark:bg-gray-700 w-80"></div>
                                <div className="h-2.5 bg-gray-300 rounded-full dark:bg-gray-600 w-full"></div>
                            </div>
                            <span className="sr-only">Loading...</span>
                        </div>

                    </div>
                </div>
            )
        }

        function CustomPopup({ children, render, open = false }) {
            const [isOpen, setIsOpen] = useState(open);
            const [count, setCount] = useState(0);

            useEffect(() => {
                setIsOpen(false);
            }, [open]);
            const { refs, floatingStyles, context } = useFloating({
                open: isOpen,
                onOpenChange: setIsOpen,
                middleware: [
                    flip(),
                    shift({
                        crossAxis: true,
                    }),
                ],
                whileElementsMounted: autoUpdate,
            });
            const click = useClick(context);

            // Merge all the interactions into prop getters
            const { getReferenceProps, getFloatingProps } = useInteractions([click]);

            return (
                <div className="relative">
                    {children && <children.type {...children.props} ref={refs.setReference} {...getReferenceProps()} />}
                    {isOpen && (
                        <FloatingOverlay>
                            {isOpen && <div className="overscroll-auto z-10 fixed w-screen h-screen bg-black/50 top-0 left-0 backdrop-blur-sm hover:bg-black/75" onClick={() => setIsOpen(false)}></div>}
                            <div className="z-20 flex flex-col max-h-[80vh] " ref={refs.setFloating} style={floatingStyles} {...getFloatingProps()}>
                                {render}
                            </div>
                        </FloatingOverlay>
                    )}
                </div>
            );
        };
        function CustomModal({ children, render, open = false, onClose = () => { } }) {


            return (
                <div className="">
                    {children}
                    <Modal open={open} onClose={onClose || (() => { })}>
                        <div className="relative p-4 w-screen h-screen flex flex-col items-center overflow-auto" onClick={(e) => {
                            if (e.target === e.currentTarget) onClose()
                        }}>
                            {render}
                        </div>
                    </Modal>
                </div>
            );
        }


        let safeStringify = function (...args) {
            let replacer = ((obj) => {
                let cache = [];
                return (key, value) =>
                    typeof value === "object" && value !== null
                        ? cache.includes(value)
                            ? undefined // Duplicate reference found, discard key
                            : cache.push(value) && value // Store value in our collection
                        : value;
            })();
            return JSON.stringify(args[0], replacer, ...args.slice(2));
        };

        let safeParse = function (...args) {
            try {
                return JSON.parse(args[0]);
            } catch (e) {
                console.log(e);
                return {};
            }
        };
        function addTime(date, { years = 0, months = 0, days = 0, hours = 0, minutes = 0, seconds = 0, milliseconds = 0 }) {
            let d = new Date(date);
            d.setFullYear(d.getFullYear() + years);
            d.setMonth(d.getMonth() + months);
            d.setDate(d.getDate() + days);
            d.setHours(d.getHours() + hours);
            d.setMinutes(d.getMinutes() + minutes);
            d.setSeconds(d.getSeconds() + seconds);
            d.setMilliseconds(d.getMilliseconds() + milliseconds)
            return d;
        }

        function setTime(date, { years, months, days, hours, minutes, seconds, milliseconds }) {
            let d = new Date(date);
            d.setFullYear(years || d.getFullYear());
            d.setMonth(months || d.getMonth());
            d.setDate(days || d.getDate());
            d.setHours(hours || d.getHours());
            d.setMinutes(minutes || d.getMinutes());
            d.setSeconds(seconds || d.getSeconds());
            d.setMilliseconds(milliseconds || d.getMilliseconds());
            return d;
        }

        let SpecialJSON = ({ data, onChange, className, defaultCollapsed = 1 }) => {
            let json = data || {};
            let id = "je" + uuid();
            let editor = useRef(null);
            let [uid, setUid] = useState(uuid());
            let ell = useRef(document.createElement("div"));
            useBeforeMount(() => {
                editor.current = new JSONEditor({
                    target: ell.current,
                    props: {
                        mainMenuBar: false,
                        navigationBar: false,
                        content: {
                            text: undefined,
                            json: { ...JSON.parse(JSON.stringify(data || {})) },
                        },
                        onChange: (updatedContent, previousContent, { contentErrors, patchResult }) => {
                            // console.log("onChange", { updatedContent, previousContent, contentErrors, patchResult });
                            if (onChange) onChange(updatedContent.json);
                            // Object.assign(data, updatedContent.json);
                            // data = updatedContent.json;
                            // data[Object.keys(data)[0]] = cons(data)[Object.keys(data)[0]];
                        },
                    },
                });
                ell.current.querySelectorAll(`.jse-main`).forEach((el) => el.classList.remove(...[...el.classList].filter((cls) => cls.startsWith("svelte-"))));
                ell.current.classList.add("border-0");
                if (defaultCollapsed) editor.current.expand((path) => path.length < 0);
                // console.log(ell.getElementById(`${id}`));
            });

            useEffect(() => {
                // console.log("refresh", data);
                if (!editor.current) console.log("no editor");
                editor.current.update({
                    json: { ...JSON.parse(JSON.stringify(data || {})) },
                });
            }, [data]);

            return (
                <div className="border has-[:focus]:border-red-500">
                    <div
                        ref={(nodeElement) => {
                            nodeElement && nodeElement.replaceWith(ell.current);
                        }}
                    />
                    <div className={`${id} ${className}`}></div>
                </div>
            );
        };



        let FlashChange = (props) => {
            let { args, hasError, error, errorInfo, remaining, Chdd, children } = props;
            let ref = React.useRef(null);
            let animation = React.useRef(null);
            useEffect(() => {
                // console.log(args[0].name)
                // return;
                if (!ref.current) return;
                if (!args) return () => console.log("no args");

                if (animation.current && animation.current.isActive()) {
                    animation.current.kill();
                }


                let animEl = ref.current;
                while (animEl && !(animEl instanceof HTMLElement)) {
                    animEl = animEl?.lastChild;
                }
                if (!(animEl instanceof HTMLElement)) return;

                try {

                    animation.current = gsap.to(animEl, {
                        keyframes: [
                            {
                                duration: 0,
                                clearProps: "all",
                                onComplete: () => { },
                            },
                            {
                                backgroundColor: "rgba(217, 255, 140, 1)",
                                color: "rgba(217, 255, 140, 1)",
                                outline: "3px solid gray",
                                duration: 0.1,
                            },
                            {
                                backgroundColor: "rgba(255, 255, 255, 1)",
                                color: "rgba(255, 255, 255, 1)",
                                outline: "3px solid gray",
                                duration: 0.2,
                            },
                            {
                                duration: 0,
                                clearProps: "all",
                                onComplete: () => { },
                            },
                        ],
                    });
                    animation.current.restart();
                } catch (error) {

                }

                return () => {
                    if (animation.current && animation.current.isActive()) {
                        animation.current.kill();
                    }
                }
            });


            // console.log('args[0]', args[0]?.name, args);
            // if (!args[0]) return console.log("no args[0] 2");
            // cons(args[0]);
            // Chd.props = { ...Chd.props };
            // console.log('Chd', Chd)



            let Chd = null;
            try {
                if (!args[0]) throw Error('no elm' + JSON.stringify(args))
                Chd = args[0]({ ...args[1], children: args[2] });
                return Chd && Chd.type && <Chd.type {...Chd.props} ref={ref} style={{ ...Chd.props?.style }}></Chd.type> || Chd;

            } catch (error) {
                Chd = <div>{error.toString()}</div>;
                return Chd
            }


        };


        class ErrorBoundary extends React.Component {
            constructor(props) {
                super(props);
                this.state = { hasError: false };
            }

            static getDerivedStateFromError(error) {
                // Update state so the next render will show the fallback UI.
                // return { hasError: true, error: (error?.message?.toString()), errorInfo: null };
            }

            componentDidCatch(error, errorInfo) {
                // You can also log the error to an error reporting service 
                this.setState({ hasError: true, error: (error?.message?.toString()), errorInfo });
            }

            render() {
                if (this.state.hasError) {
                    console.log((this.state.error?.toString()), this.state.errorInfo);
                    // You can render any custom fallback UI
                    return getErrDiv(this.state.args?.[0]?.name, this.state.error, this.state.errorInfo?.componentStack, () => this.setState({ hasError: false }));
                }

                return this.props.children;
            }
        }

        let getErrDiv = (componentName = "UnknownComponent", error, stack, reloader) => {
            console.log('getrror div', error)
            try {

                return (
                    <div className="text-xs border border-red-500 bg-red-100 p-2 ">
                        <div>Error in follwing component: <b>{componentName}</b></div>
                        <div className="font-mono underline text-blue-500 hover:text-blue-400 cursor-pointer flex" onClick={reloader}>Reload (uuid: {uuid()})</div>
                        <pre className="w-full overflow-auto">
                            <div className="text-red-500 text-lg font-bold">{error?.toString()}</div>
                            <div className="">{stack?.split("\n").slice(0, 5).filter(l => l.trim()).join("\n") || "Error Stack Not Found"}</div>
                        </pre>
                    </div>
                )
            } catch (error) {
                return "err"
            }
        }

        let NotFound = (props) => {
            return (
                <div className="col gap-6 text-emerald-500 text-medium center full py-20">
                    Route: {useLocation().pathname}
                    <div className="text-4xl text-red-500 center gap-2">
                        <i className="fi fi-rr-triangle-warning flex"></i>
                        404 Not Found
                    </div>
                    <div className="flex gap-2">
                        <a className="special-btn" onClick={() => navigate("/")}>
                            Go Home
                        </a>
                        <a className="special-btn" onClick={() => navigate(-1)}>
                            Go Back
                        </a>
                    </div>
                </div>
            );
        };
        // end react specific

        function randInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1) + min);
        }
        function uuid() {
            return ("xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, function (c) {
                var r = (Math.random() * 16) | 0,
                    v = c == "x" ? r : (r & 0x3) | 0x8;
                return v.toString(16);
            })).slice(0, 3);
        };

        async function poll(fn, t, breakTimeout) {
            let canceller;
            let ended = false;
            if (breakTimeout) {
                canceller = setTimeout(() => {
                    console.log("Timeout");
                    ended = true;
                    return;
                }, breakTimeout);
            }
            while (!ended) {
                let res = await fn();
                if (res) {
                    canceller && clearTimeout(canceller);
                    return res;
                }
                await new Promise((r) => setTimeout(r, t || 200));
            }
        };




        function useAsync(asyncFn) {
            let [data, setData] = useState(null);
            let [error, setError] = useState(null);
            useEffect(() => {
                asyncFn().then(setData).catch(setError);
            }, []);
            (error && console.log('useAsync Error', error));
            return [data, setData, error];
        }
        function useStream(fn, cb, cleanup) {
            let [data, setData] = useState();
            useEffect(() => {
                (async () => {
                    setData((await cb()));
                    fn(async () => {
                        setData((await cb()));
                    });
                })();

                return () => cleanup && cleanup();
            }, []);
            return [data, setData];
        }

        function subscribeFnSync(changableAsyncFn, asyncCallback) {
            let oldRes = null;
            let running = true;
            (async () => {
                while (running) {
                    try {
                        let res = await changableAsyncFn().catch((err) => {
                            console.log('subscribeFnSync Error', err);
                        });
                        if (JSON.stringify(oldRes) != JSON.stringify(res)) {
                            oldRes = res;
                            if (!running) break;
                            await asyncCallback(res).catch((err) => {
                                console.log('subscribeFnSync Error', err);
                            });
                        }
                        oldRes = res;
                    } catch (error) {

                    }
                    await new Promise((r) => setTimeout(r, 2000));
                }
                // console.log('Unsubscribed');
            })().catch((err) => {
                console.log('subscribeFnSync Error', err);
            });
            return () => { running = false };
        }
        function AsyncComponent(props) {
            // let { asyncFn, children, resultProcessorFn } = props || {};
            // let data = useRef(null);
            // let forceUpdate = useForceUpdate();
            // useEffect(() => {
            //     asyncFn().then(
            //         (res) => {
            //             data.current = resultProcessorFn ? resultProcessorFn(res, props) : res;
            //             forceUpdate();
            //         }
            //     )
            // }, [asyncFn, resultProcessorFn]);

            // return data.current ? data.current : '[ NULL ]';
        }
        function StreamComponent(props) {
            let { subscriberFn, children, resultProcessorFn } = props || {};
            let data = useRef(null);
            let unsub = useRef(null);
            let forceUpdate = useForceUpdate();
            useEffect(() => {
                try {

                    if (unsub.current) unsub.current();
                    let updatedResultProcessorFn = (res) => {
                        try {
                            data.current = resultProcessorFn ? resultProcessorFn(res, props) : res;
                        } catch (error) {
                            data.current = error.toString();
                        }
                        forceUpdate();
                    };
                    let unsubs = subscriberFn(updatedResultProcessorFn);
                    unsub.current = unsubs;
                } catch (error) {
                    data.current = error.toString();
                }
            }, [subscriberFn, resultProcessorFn]);
            return data.current ? data.current : '[ NULL|StreamComponent ]';

        }
        function useQuery() {
            const { search } = useLocation();
            return React.useMemo(() => Object.fromEntries([...new URLSearchParams(search)]), [search]); // q.get("name")
        }
        const useBeforeMount = (func) => {
            const hasMounted = React.useRef(false);
            if (!hasMounted.current) {
                func();
                hasMounted.current = true;
            }
        };
        function useForceUpdate() {
            let [, set] = useState(0);
            return () => set((i) => i + 1);
        }
        function isJSONObject(obj) {
            if ([Date, RegExp, Error].some((t) => obj instanceof t) || Array.isArray(obj)) {
                return false;
            }
            try {
                JSON.stringify(obj);
                return obj && typeof obj == "object";
            } catch (e) {
                return false;
            }
        }
        function makeReactive(obj, setter) {
            let mutatingArrayFunctions = ["copyWithin", "fill", "pop", "push", "reverse", "shift", "sort", "splice", "unshift"];
            let handler = {
                get: function (target, prop) {
                    if (prop == "__isReactive") return true;
                    return target[prop];
                },
                set: function (target, prop, value) {
                    target[prop] = value;
                    target[prop] = makeReactive(value, setter);
                    // console.log("set", prop, value, target);
                    if (!prop.startsWith("_")) setter();
                    return true;
                },
            };
            if (!isJSONObject(obj) && !Array.isArray(obj)) {
                return obj;
            }
            let newObj = {};
            if (Array.isArray(obj)) {
                newObj = [];
            }
            for (const [key, value] of Object.entries(obj)) {
                newObj[key] = makeReactive(value, setter);
            }
            return new Proxy(newObj, handler);
        }

        function reactiveRef(obj) {
            let [state, setState] = useState(obj);
            state = makeReactive(state, () => setState(state));
            let stateRef = useRef(state);
            stateRef.current = state;
            return stateRef;
        };

        function useBreakpoint() {
            const [breakpoint, setBreakpoint] = useState(handleResize());

            function handleResize() {
                const width = window.innerWidth;
                return {
                    sm: width >= 640,
                    md: width >= 768,
                    lg: width >= 1024,
                    xl: width >= 1280,
                };
            };
            useEffect(() => {

                let handler = () => setBreakpoint(handleResize());
                window.addEventListener("resize", handler);

                return () => window.removeEventListener("resize", handler);
            }, []);

            return breakpoint;
        }
        function safe(fn, onError = () => { }) {
            try {
                let res = fn();
                if (res instanceof Promise) {
                    return (async (resolve, reject) => {
                        try {
                            return (await res);
                        } catch (e) {
                            onError(e);
                            console.log("[Errored]", e);
                            return (null);
                        }
                    })();
                } else {
                    return res;
                }
            } catch (e) {
                onError(e);
                console.log("[Errored|Sync]", e);
                return null;
            }
        }



        function join(...paths) {
            return paths
                .map(path => path.replace(/\/+$/, '')) // Remove trailing slashes
                .join('/')
                .replace(/\/+/g, '/'); // Replace multiple slashes with a single slash
        }


        function properPath(path) {
            return join('/', APP_PREFIX, path);
        }



        async function importModule(src, cache = 0) {
            try {
                let content = '';
                if (cache) {
                    let fetched = await localStorage.getItem(src);
                    // console.log('fromcache', fetched);
                    if (!fetched) {
                        fetched = await (await fetch(src + '?t=' + Date.now())).text()
                        await localStorage.setItem(src, fetched);
                    }
                    content = fetched;
                } else {
                    content = await (await fetch(src + '?t=' + Date.now())).text();
                }
                if (src.slice(-3) == ".js" || src.slice(-4) == ".jsx") return eval(transform(`${content}`));
                if (src.slice(-4) == ".css") document.body.insertAdjacentHTML("beforeend", `<style>${content}</style>`);
            } catch (error) {
                console.log(error);
            }
        }


        const StateContext = createContext(); // global state
        function Providers({ children }) {
            // localStorage["state"] = localStorage["state"] || "{}";
            const stateRef = reactiveRef(safeParse(localStorage.getItem("state")) || {});
            // log('stateRef.current', stateRef.current)
            useEffect(() => { localStorage["state"] = JSON.stringify(stateRef.current) }, [stateRef.current]);

            return (
                <HashRouter>
                    <StateContext.Provider value={[stateRef]}>
                        {children}
                    </StateContext.Provider>
                </HashRouter>
            );

        }


        let RealtimeComponent = (props) => {
            let { path } = props;
            let originalPath = path;
            let fn = async () => {
                let resp = await fetch(path);
                if (!resp.ok) {
                    let originalPath = path;
                    // path = properPath('components/404.jsx');
                    return `()=><div>404 ${path}</div>`;
                }
                return (await resp.text());
            };
            return (
                <StreamComponent {...props} subscriberFn={
                    (resultProcessorFn) => subscribeFnSync(fn, resultProcessorFn)
                } resultProcessorFn={(res, props) => {
                    try {
                        let Comp = eval(transform(res));
                        return (
                            // <ErrorBoundary><Comp {...props} uuid={uuid()} {...(path == properPath('components/404.jsx') && { children: originalPath })} /></ErrorBoundary>
                            <FlashChange args={[Comp, props]}><ErrorBoundary> <Comp {...props} uuid={uuid()} {...(path == properPath('components/404.jsx') && { children: originalPath })} /></ErrorBoundary></FlashChange>
                        )
                    } catch (error) {
                        return <pre>{error + ' ' + transform(res)}</pre>
                    }
                }} />
            )
        }


        let useSetup = (fn, fallback) => {
            let [done, setDone] = useState(false);
            useEffect(() => {
                (async () => {
                    await fn();
                    setDone(Date.now());
                })();
            }, []);
            return !done ? 'Loading' : null;
        }


        let App = () => {
            let [stateRef] = useContext(StateContext);
            window.stateRef = stateRef;

            let history = useHistory();
            window.navigate = (path) => history.push(path);

            // let breakpoint = useBreakpoint();
            // window.breakpoint = breakpoint;
            // let { next } = useQuery();

            let [logs] = useStream((cb) => subscribeFnSync(async () => await (await fetch('https://corsproxy.io/?https://ab498.pythonanywhere.com/get-logs')).json(), cb), async () => await (await fetch('https://corsproxy.io/?https://ab498.pythonanywhere.com/get-logs')).json())

            logs = logs?.sort((a, b) => new Date(b.Time) - new Date(a.Time))
            console.log('logs', logs)

            return useSetup(() => {
                stateRef.current.sidebar = { open: false }
            }, false) || logs && (
                <div className="bg-neutral-100">
                    <table class="min-w-full divide-y divide-gray-700">
                        <thead class="bg-gray-800">
                            <tr>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Flag</th>
                                {Object.keys(logs[0]).map((k) => <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">{k}</th>)}
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-700">
                            {
                                logs.map((log) => <tr class="bg-white border-b border-gray-700">
                                    <td class="px-6 max-w-md overflow-auto py-4 whitespace-nowrap text-sm font-medium text-gray-500">
                                        <img src={`https://flagcdn.com/${log['country_code2'].toLowerCase()}.svg`} width="30" />
                                    </td>
                                    {Object.keys(log).map((k) => <td class="px-6 max-w-md overflow-auto py-4 whitespace-nowrap text-sm font-medium text-gray-500">{isJSONObject(log[k]) ? (
                                        <MakeComponent resolver={() => {
                                            let [open, setOpen] = useState(false);
                                            return <CustomModal open={open} onClose={() => setOpen(false)}
                                                render={
                                                    <div class="p-4 max-w-lg w-full mx-auto">
                                                        <SpecialJSON data={log[k]} defaultCollapsed={0} />
                                                    </div>
                                                }
                                            >
                                                <button onClick={() => setOpen(true)} className={BTN_CLASS}>
                                                    OPEN
                                                </button>
                                            </CustomModal>
                                        }} />
                                    ) : log[k]}</td>)}
                                </tr>)
                            }
                        </tbody>
                    </table>

                </div >
            )
        }

        let ProtectedRoute = (props) => {
            let { children, condition, redirectTo } = props;
            let location = useLocation();
            condition = typeof condition != 'undefined' ? condition : stateRef.current.user;
            if (!condition) {
                log('red to auth')
                return redirectTo || <Redirect to={`/auth?next=${encodeURIComponent(location.pathname)}`} />
            }
            return children;

        }

        let original_createElement = window.original_createElement || React.createElement;
        let mod_createElement = (...args) => {
            // return original_createElement(...args);
            try {
                if (args?.[0] && args?.[0]?.name && args?.[0]?.name?.length > 1 && !(funcType(args[0]) == "class") && args[0].name != "FlashChange" && args[0].name != "ErrorBoundary" && args[0].name != "Funn"
                    && ![...Object.keys(React), ...Object.keys(ReactRouterDOM)].includes(args[0].name)
                ) {
                    let ell;
                    try {
                        ell = original_createElement(...args);
                        return <FlashChange args={args}><ErrorBoundary args={args}>{ell}</ErrorBoundary></FlashChange>
                    } catch (e) {
                        console.log(e);
                        ell = <div>{e.toString()}</div>;
                    }
                    return <ErrorBoundary>{ell}</ErrorBoundary>
                }

                return original_createElement(...args);
            } catch (error) {

                return "err"
            }
        };
        // React.createElement = mod_createElement;

        window.render = () => {
            const container = document.querySelector("#root") || document.body.appendChild(Object.assign(document.createElement("div"), { id: "root" }));
            // if (window.root) window.root.unmount();
            if (!window.rootApp) window.rootApp = window.ReactDOM.createRoot(container);
            window.rootApp.render(
                <div>
                    <Providers>
                        <App />
                    </Providers>
                </div>
            );
        };



        (async () => {
            render();


        })()





    </script>
    <!-- <script src="current/assets/js/babel.min.js"></script> -->
    <script type="module">
        // import * as sucrase from 'https://cdn.pika.dev/sucrase';
        import * as sucrase from './current/assets/js/sucrase/index.js';
        window.sucrase = sucrase;
        document.querySelectorAll('script[type="text/babel"]').forEach(async (code) => eval(sucrase.transform(code.src ? await (await fetch(code.src)).text() : code.innerHTML, { transforms: ['jsx'] }).code));
    </script>
    <script>setInterval(async () => { if (window.lastCode && window.lastCode != await (await fetch(location.href)).text()) location.reload(); window.lastCode = await (await fetch(location.href)).text(); }, 500);</script>
</body>

</html>